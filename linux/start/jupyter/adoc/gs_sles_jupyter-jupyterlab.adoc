:docinfo:
include::./common_docinfo_vars.adoc[]

// Variables & Attributes
:title: JupyterLab with SUSE Linux Enterprise: Getting Started
:productname: SLES 15 SP4
:productver: 15 SP4
:defaultpython: Python 3.6
:defaultpythonbin: python3.6
:partnerprod1: JupyterLab
:partnerprod2: Jupyter Notebook
:author1: Brian Fromme, Technical Alliance Manager, SUSE
:author2: Terry Smith, Partner Solutions Director, SUSE
// Deprecated variables & attributes - do not use
//:subtitle: Machine Learning with SUSE Linux Enterprise and Rancher
//:revdate: August, 2022
//:revnumber: 20220804
//:toc2:
//:toc-title: {title}
//:toclevels: 4

= {title}

== Introduction

=== Motivation

// Why this would be of interest
// Challenges
// Benefits

// TS: There is some good text here (https://medium.com/@olivier.borderies/jupyter-python-in-the-corporate-lan-109e2ffde897) to explain why JupyterLab.  We would just want to integrate in SLE value.

Introducing Machine Learning (ML) into a company strategy is exciting.
ML can yield many benefits but implementation can sometimes be a challenge.
A successful ML strategy must be comprehensive, supporting the entire process, from development to production.

ML research is highly collaborative and largely open source, resulting in a rapid state of continuous development.
ML developers often need to leverage leading edge technologies (hardware and software) and to be able to share ideas, experiments, and even code and data to accelerate innovation.
A successful ML strategy provides a support framework for researchers and developers.

Scaling ML from a research project to enterprise production is no easy task.
IT teams are called upon to support leading edge development and to ensure stable, secure production at scale.



SUSE collaborates with project communities and partners to simplify leveraging the components and complex toolchains used in ML development.
SUSE Linux Enterprise (SLE) is the operating system of choice for ML developers looking for a stable, performant, and secure platform that can easily scale to enterprise production.

The https://www.python.org/[Python] programming language is popular among ML researchers and developers.
Python is described as ideal for prototype development due to its ease-of-use, extensibility, cross-platform availability, open source license, and more.
And a large ecosystem of ML-related tools and capabilities have built up around Python.


Open source communities are very good at overcoming such challenges.
A plethora of features, capabilities, and tools have sprung up to facilitate sharing and replicability.
These include package repositories, package management tools, isolated "virtual" environments, and computational notebooks.



=== Scope

This guide provides a brief introduction to the following concepts, tools, and applications:

* https://www.python.org/[Python] in the {productname} environment.

* The https://pypi.org/[Python Package Index (PyPI)] repository.

* The pip Python package management tool.

* Lightweight virtual environments with https://docs.python.org/3/library/venv.html[venv].

* Interactive, computational notebooks with https://jupyter.org/[Project Jupyter]


[NOTE]
====
Many of the steps herein may be followed with little or no modification on the corresponding version of openSUSE Leap.
====


=== Audience

This guide is intended for developers, data scientists, ML researchers, and others interested in leveraging the JupyterLab next generation, interactive, computational notebook environment.
The deployment instructions in this document assume only an introductory understanding of Linux commands.


== Prerequisites

For this guide, you need:

* https://www.suse.com/products/server/[SUSE Linux Enterprise Server] {productver} or the corresponding version of https://www.opensuse.org/[openSUSE] Leap.

** If you do not already have SLES installed, instructions can be found here:  https://documentation.suse.com/sles/15-SP4/html/SLES-all/book-deployment.html

** Make sure your SLES installation is up-to-date by running `zypper patch`, `zypper update`, or by using https://documentation.suse.com/sles/15-SP4/html/SLES-all/cha-onlineupdate-you.html[YaST online update].

* Python 3
+
//
{defaultpython} is included with {productname} and is used in this guide.
This is adequate to run JupyterLab and many ML toolkits.
+
[NOTE]
====
Legacy Python 2.x and other versions of Python can also be installed on your system.
To avoid accidentally executing the wrong version, this guide uses version-explicit commands, like `{defaultpythonbin}` or `python3` (leveraging a symbolic link to the appropriate binary).
====

* Access to https://pypi.org/[The Python Package Index (PyPI)].
+
//
PyPI is a public repository of software for the Python programming language.



== Setting up your Python environment

ML toolkits are in fast development and often have strict version dependencies.
Installing dependent packages to support one project may, thus, break another project.
Developers need a way to create isolated environments where they can install the packages they need without impacting other projects or systems operations.


=== Multiple versions of Python

Your application may have a hard dependency for a specific version of the Python interpeter itself.

You can install multiple versions of Python on your system.
But care must be taken, as doing so incorrectly could break system tools.

To mitigate this risk, SUSE names the Python binaries explicitly.
For example, {productname} includes {defaultpython} and the default Python interpeter is the file, '/usr/bin/{defaultpythonbin}'.
This file is symbolically linked as 'python3' to simplify usage and offer consistency.
So, when you issue the command `python3 --version`, this is actually executing, `{defaultpythonbin} --version`.
If you install another version of Python from the SUSE repositories, say Python 3.10, the interpreter will be installed as '/usr/bin/python3.10'.

With this naming convention, you can install and maintain multiple versions of Python on your system.
However, managing these can be challenging.
Tools, like https://github.com/pyenv/pyenv[pyenv], have been developed to help with this but are out of scope for this guide.

For this guide, the default {defaultpython} is sufficient.



=== Creating a Python virtual environment

The https://docs.python.org/3/tutorial/venv.html[Python venv module] provides a mechanism for creating lightweight "virtual environments" and gives us a tool for isolating software dependencies.
See the https://peps.python.org/pep-0405/[Python Enhancement Proposal 405 - Python Virtual Environments] for more details on the venv module.

Creating a Python virtual environment is easy.
Run the following commands as your user (root access is not required):

. Create a virtual environment, named 'myproj'.
+
[source,bash]
----
python3 -m venv $HOME/myproj
----
+
This creates a new 'myproj' subdirectory in your home directory and populates it with files, subdirectories, and symbolic links to enable the virtual environment.

. Change to the new directory.
+
[source, bash]
----
cd $HOME/myproj
----

. Activate the new virtual environment.
+
[source, bash]
----
source ./bin/activate
----
+
The 'activate' script cannot be run on its own and must be "sourced" in order to update current environment variables in support of the isolated environment.
+
[TIP]
====
When your virtual environment is active, your command prompt is prefixed with the environment name.
In the present example, you should see '(myproj)' before your normal prompt.
====

. Deactivate your active virtual environment.
+
[source, bash]
----
deactivate
----
+
When you are done working in this virtual environment, you can use the `deactivate` command to reset all the environment changes (including your prompt).
This does not delete the virtual environment.
To reactivte it, simply source the activte script again.

You can use the Python venv module to create as many virtual environments as you need, each in its own working directory.


[NOTE]
====
If you no longer need a virtual environment and want to delete it, simply:

. Deactivate the environment.
. Delete its working directory.
====



== Managing Python packages

Python is not the only language or even the best language for all ML software development.
But Python is popular among ML developers for its simplicity, elegance, and its large open source community of active developers and users.
ML developers benefit greatly from a wealth of open source code, much of which has been packaged and licensed for easy use in other software.

The {productname} repositories include many of these Python packages, tested against the included version of Python.
These Python packages are perfect if the version matches what you need for your project and you can install them system-wide.


The https://pypi.org/[Python Package Index (PyPI)] is a public repository of open source licensed packages made available by a community of developers from around the world.
There are many ways to install Python packages from PyPI, but the preferred method is with the `pip` command.

`pip` is a powerful tool for managing Python packages.
By default, `pip` installs packages from PyPI, but it can also install from a git repository or local distribution files.
Many Python packages are dependent on other packages.
`pip` is capable of performing dependency resolution and installing the required packages.
See the https://pip.pypa.io/en/stable/[pip documentation] for details on additional capabilities and options.

In this guide, you will use the `pip` command to install packages from PyPI into your active virtual environment.


[NOTE]
====
Your Python virtual environment has its own `pip`, installed in the 'bin' subdirectory of your working directory (e.g., '$HOME/myproj/bin').
Use `pip --version` to see which `pip` will be used.
====


=== Performing basic package management

In the following commands, you will perform some basic operations with `pip`.

. Activate your virtual environment.
+
[source, bash]
----
cd $HOME/myproj
source ./bin/activate
----

. Upgrade the `pip` command itself to the latest version.
+
[source, bash]
----
pip install --upgrade pip
----

. Install a specific version of the https://pypi.org/project/numpy/1.18.5/[numpy] package.
+
[source, bash]
----
pip install numpy==1.18.5
----
+
[TIP]
====
Be sure to use two equal signs ('==') between the package name and the desired version.
====

. Upgrade to the latest compatible version of numpy.
+
[source, bash]
----
pip install --upgrade numpy
----
+
[NOTE]
====
You may not actually get the "latest" version of a package.
Instead, you get the latest version that is compatible with your Python environment.
====

. Uninstall numpy.
+
[source, bash]
----
pip uninstall numpy
----

. Install multiple packages together (numpy, pandas, and matplotlib).
+
[source, bash]
----
pip install numpy pandas matplotlib
----
+
[source, bash]
----
Collecting numpy
  Using cached numpy-1.19.5-cp36-cp36m-manylinux2010_x86_64.whl (14.8 MB)
Collecting pandas
  Using cached pandas-1.1.5-cp36-cp36m-manylinux1_x86_64.whl (9.5 MB)
Collecting matplotlib
  Using cached matplotlib-3.3.4-cp36-cp36m-manylinux1_x86_64.whl (11.5 MB)
Collecting pytz>=2017.2
  Using cached pytz-2022.2.1-py2.py3-none-any.whl (500 kB)
Collecting python-dateutil>=2.7.3
  Using cached python_dateutil-2.8.2-py2.py3-none-any.whl (247 kB)
Collecting pyparsing!=2.0.4,!=2.1.2,!=2.1.6,>=2.0.3
  Using cached pyparsing-3.0.9-py3-none-any.whl (98 kB)
Collecting cycler>=0.10
  Using cached cycler-0.11.0-py3-none-any.whl (6.4 kB)
Collecting pillow>=6.2.0
  Using cached Pillow-8.4.0-cp36-cp36m-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (3.1 MB)
Collecting kiwisolver>=1.0.1
  Using cached kiwisolver-1.3.1-cp36-cp36m-manylinux1_x86_64.whl (1.1 MB)
Collecting six>=1.5
  Using cached six-1.16.0-py2.py3-none-any.whl (11 kB)
Installing collected packages: six, pytz, python-dateutil, pyparsing, pillow, numpy, kiwisolver, cycler, pandas, matplotlib
Successfully installed cycler-0.11.0 kiwisolver-1.3.1 matplotlib-3.3.4 numpy-1.19.5 pandas-1.1.5 pillow-8.4.0 pyparsing-3.0.9 python-dateutil-2.8.2 pytz-2022.2.1 six-1.16.0
----
+
[NOTE]
====
`pip` automatically downloaded and installed additional dependencies.
====


=== Creating repeatable experiments

Replicabality is key to many disciplines, but particularly in the sciences.
Ensuring that your Python environment can be recreated the same way with the same packages and the same versions of those packages can be a challenge.

Fortunately, wth the `pip freeze` command, you can generate a package requirements file, containing a list of the packages and versions that should be installed.
See https://pip.pypa.io/en/stable/cli/pip_freeze/ for more information.


Create a requirements file for your Python virtual environment by following these steps:

. Activate your virtual environment (if not already active).

. Generate a requirements file with `pip freeze`.
+
[source, bash]
----
pip freeze > myproj-reqs.txt
----

. Take a look at the requirements file.
+
[source, bash]
----
less myproj-reqs.txt
----
+
[source, bash]
----
cycler==0.11.0
kiwisolver==1.3.1
matplotlib==3.3.4
numpy==1.19.5
pandas==1.1.5
Pillow==8.4.0
pyparsing==3.0.9
python-dateutil==2.8.2
pytz==2022.2.1
six==1.16.0
----


Now, you can use this requirements file to ensure a new environment has all the same pacakges installed.

. Make you are not in an active Python virtual environment.

. Create a new Python virtual environment.
+
[source, bash]
----
python3 -m venv myproj2
----

. Activate the new environment.
+
[source, bash]
----
cd myproj2
source ./bin/activate
----

. Upgrade `pip`.
+
[source, bash]
----
pip install --upgrade pip
----

. Install packages with the requirements file.
+
[source, bash]
----
pip install -r $HOME/myproj/myproj-req.txt
----

. Verify correct packages were installed.
+
[source, bash]
----
pip list
----
+
[source, bash]
----
Package         Version
--------------- --------
cycler          0.11.0
kiwisolver      1.3.1
matplotlib      3.3.4
numpy           1.19.5
pandas          1.1.5
Pillow          8.4.0
pip             21.3.1
pyparsing       3.0.9
python-dateutil 2.8.2
pytz            2022.2.1
setuptools      44.1.1
six             1.16.0
----




== Project Jupyter

https://jupyter.org/[Project Jupyter] was born out of the https://ipython.org/[IPython Project] in 2014 to support interactive data science and scientific computing across all programming languages.
Under this umbrella are:

* Jupyter Notebook
+
//
The original web application allows data scientists to create and share computational documents, called notebooks.

* JupyterLab
+
//
The latest generation of Jupyter Notebook is a modular design that wllows users to customize the interface to support workflows in data science, scientific computing, computational journalism, and machine learning.

* JupyterHub
+
//
Provides a multi-user experience, enabling centralized deployment and user management.

* VoilÃ 
+
//
Transforms Jupyter notebooks into secure, stand-alone web applications.


Next, you will learn how to install and access JupyterLab.



. Install JupyterLab.
+
//
JupyterLab is easy to install right from PyPI.
In your active virtual environment, issue the following command:
+
[source, bash]
----
pip install jupyterlab
----


=== Access JupyterLab

Jupyter Lab is a web application.
Once it is started, you access it through your web browser.


Start JupyterLab from the command-line with:

[source, bash]
----
jupyter-lab
----

This fills your terminal window with some helpful information, like the following:

[source, bash]
----
[I 2022-08-22 13:14:26.394 ServerApp] Jupyter Server 1.13.1 is running at:
[I 2022-08-22 13:14:26.394 ServerApp] http://localhost:8888/lab?token=4baab78a6959bbc8b9992572b8faf7d2416741c2d00768f7
[I 2022-08-22 13:14:26.394 ServerApp]  or http://127.0.0.1:8888/lab?token=4baab78a6959bbc8b9992572b8faf7d2416741c2d00768f7
[I 2022-08-22 13:14:26.394 ServerApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).
[C 2022-08-22 13:14:26.398 ServerApp] 
    
    To access the server, open this file in a browser:
        file:///home/suse/.local/share/jupyter/runtime/jpserver-31811-open.html
    Or copy and paste one of these URLs:
        http://localhost:8888/lab?token=4baab78a6959bbc8b9992572b8faf7d2416741c2d00768f7
     or http://127.0.0.1:8888/lab?token=4baab78a6959bbc8b9992572b8faf7d2416741c2d00768f7
----

[NOTE]
====
JupyterLab uses an access token to authenticate you to the web UI.
This token is unique to each instance of the environment.
====

JupyterLab will attempt to open your default web browser with the proper URL to bring up the user interface.
If no default web browser is configured or fails to open, you can use one of the suggested URLs shown in your command terminal.


[TIP]
====
If your environment is on a remote, headless host, you can use SSH port forwarding to gain access.

. Log into the remote host with a local port forward.
+
[source, bash]
----
ssh -L8888:localhost:8888 USER@REMOTE-IP
----
+
where USER is your username on the remote host and REMOTE-IP is its IP address or domain name.

. Activate your virtual environment.

. Launch JupyterLab.

. Open your local web browser to the URL specified in your command terminal.
====

. Shut down JupyterLab.
+
* You can shut down the JupyterLab environment directly from the UI by selecting __File > Shutdown__.
* If you select __File > Logout__ in the UI or just close your browser, you can shut down the JupyterLab environment from the command terminal by issuing 'CTRL-C'.
You will be prompted to confirm that you want to shut down the Jupyter server.
+
[TIP]
----
You can bypass confirmation by issuing 'CTRL-C' twice.
----


=== Explore the JupyterLab interface

==== User Interface Overview

Here's a quick overview of the JupyterLab main user interface.
At the top of the page is the menu bar, which currently contain the menus:
*File Edit View Run Kernel Tabs Settings Help*

//image::jupyterlab_ui_001.png[JupyterLab user interface, scaledwidth="85%", align="center"]
image::JupyterLab-first-Ui.png[JupyterLab main user interface, scaledwidth="85%", align="center"]

Along the left-hand side are the browsing icons, which currently contain: +
*File Browser* +
*Running Terminals and Kernels* +
*Table of Contents* +
*Extension Manager* +
 +

image::JupyterLab-File+Launcher-small.png[JupyterLab main user interface, scaledwidth="85%", align="center"]
// JupyterLab-File+Launcher-Load-Name.png
// JupyterLab-File+Launcher-Load.png
// JupyterLab-File+Launcher-NewFolder.png
// JupyterLab-File+Launcher-Open.png
// JupyterLab-File+Launcher-small.png
// JupyterLab-first-Ui.png

In the next section, we will explore an example notebook and then load that notebook into your own environment.
You will make use of the JupyterLab *File Browser* to load the example.

. Create JupyterLab folder.
+
* Click on the __File Browser__ icon in the JupyterLab main user interface.
* Next, click on __New Folder__ icon, which is the second icon to the right.
* A new folder item will appear in the list, with the text:  __Untitled Folder__
* Change this text to:  __notebook__
+
This __notebook__ folder is a convenient place to store your uploaded notebooks.
+
[TIP]
----
Choose any folder name, or put notebooks elsewhere in your folder hierarchy.
----

image::JupyterLab-File+Launcher-NewFolder.png[JupyterLab main user interface, scaledwidth="85%", align="center"]


==== Example Overview

Next we will explore an example use case to show how you can use JupyterLab in your machine-learning project.
We have choose a simple https://en.wikipedia.org/wiki/Logistic_regression[logistic regression,role=external,window=_blank]
   example from the https://www.kaggle.com[Kaggle,role=external,window=_blank] competition website.

The example is a logistic regression that predicts which passengers survived the Titanic shipwreck.
We hope you find this learning experiment useful.

You can run this example on the Kaggle infrastructure, or on your own Jupyter installation.
The goal here is to learn how to manipulate Jupyter notebooks and run experiments, preparing you to build your own.

To load the example notebook, please enter this URL into your browser:
https://www.kaggle.com/code/raman2000/titanic-machine-learning[Titanic - Machine Learning,role=external,window=_blank]

Next, learn more about the notebook and the competition that inspired it here:
https://www.kaggle.com/competitions/titanic[Titanic - Machine Learning from Disaster,role=external,window=_blank]

So far, we have explored this example notebook by using the
https://www.kaggle.com[Kaggle,role=external,window=_blank] competition website.
Now let's load this same example into your own environment.

==== Load the Titanic Notebook into your JupyterLab interface

We will use the __curl__ command to download the Titanic example directly to your *notebook* folder.

. Download the Titanic Example
+
[source, bash]
----
cd ~/myproj/notebooks
curl URL-OF-TITANIC
----
+

. Open the Titanic Notebook in JupyterLab.
+
* Click on the __File Browser__ icon in the JupyterLab main user interface.
* Next, click on __notebook__ folder.  You should see the notebook named: __titanic-machine-learning.ipynb__
* Double-click on this notebook to open it.

image::JupyterLab-File+Launcher-Load.png[JupyterLab main user interface, scaledwidth="85%", align="center"]

image::JupyterLab-File+Launcher-Open.png[JupyterLab main user interface, scaledwidth="85%", align="center"]

+
[TIP]
----
You can also right-mouse on an item in JupyterLab to see possible operations.
----

Now that you have the notebook open, you would begin editing with any changes.
You can also run the notebook, but this example depends on data.

NOTE:  Ugh, loading the data is a drag. Let's discuss this.

. Save your work
+
* From the notebook view, click on the __Save__ icon.
+
[TIP]
----
If you hoover on the Save icon, you will see: Save and create checkpoint (Ctrl+S)
----


==== Next Steps with JupyterLab

At this point, you should have enough guidance to begin experiments with Jupyter.
We encourage you to find other examples and play with those too.
At some point, you may want to dive into the code and perhaps even enhance the model.

When you are ready, you can find more examples at:
https://coderefinery.github.io/jupyter/examples/[Examples of Jupyter features,role=external,window=_blank]

Also, here's a more thorough introduction to Jupyter and JupyterLab:
https://coderefinery.github.io/jupyter/[Introduction to Jupyter and JupyterLab,role=external,window=_blank]

// TS: Take a look at https://coderefinery.github.io/jupyter/examples/ for some examples.  Let's keep the example here simple.  We're really focused on just getting JupyterLab with SLE into the mind of the reader for this document.


== Summary

//Summarize the motivation
//Summarize what was demonstrated
//Hint at other capabilities.

Machine Learning is a fascinating and highly-successful technology that companies are putting into practice.
The many advantages of SUSE Linux Enterprise operating systems and Rancher container management are a logical place to develop and deploy ML applications.
This guide is meant to help you to begin your journey into machine learning on SUSE software.
Other guides in this series will help you to utilize various ML toolkits and create containers that land on Rancher Kubernetes Engine.
We will build up to an architecture and explanation for how to employ machine learning in your Edge and/or Digital Transformation projects.

This guide simply showed you how Jupyter notebooks can easily be deployed and we hope you find value in that tool.

SUSE collaborates with hardware vendors to bring you reliable hardware and software infrastructure for the enterprise modernization.
You can count on our partnerships to deliver a complete solution based on SUSE Linux Enterprise and Rancher software.



== Additional resources

Learn more about the capabilities of Jupyter with these additional references.

// an unordred lists for references
* https://jupyter.org/[Project Jupyter | Home]
* https://coderefinery.github.io/jupyter/[Introduction to Jupyter and JupyterLab]
* https://coderefinery.github.io/jupyter/examples/[Examples of Jupyter features]
* https://www.kaggle.com[Kaggle]
* https://www.kaggle.com/code/raman2000/titanic-machine-learning[Titanic - Machine Learning]


++++
<?pdfpagebreak?>
++++

// Standard SUSE Technical Reference Documents includes

:leveloffset: 0

== Legal notice
include::common_trd_legal_notice.adoc[]

++++
<?pdfpagebreak?>
++++


:leveloffset: 0
include::common_gfdl1.2_i.adoc[]

//end
