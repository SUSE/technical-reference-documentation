:docinfo:
include::./common_docinfo_vars.adoc[]
include::./gs_virtualization_veeam-kasten-vars.adoc[]
[#art-{article-id}]

// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =
// SUSE Technical Reference Documentation
// Getting Started Guide
// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
//
// DOCUMENT ATTRIBUTES AND VARIABLES
//
// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
// 1. Define variables (document attributes) in the vars file.
// 2. Develop content and reference variables in the adoc file.
// 3. Update the docinfo.xml file as needed.
// 4. Update DC file (at a minimum, deactivate DRAFT mode)
//
// For further guidance, see
//   https://github.com/SUSE/technical-reference-documentation/blob/main/common/templates/start/README.md
// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =



= {title}: {subtitle}



== Introduction

// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =
// Provide a motivation for the document in 2-4 sentences to identify:
//   - what the document is about
//   - why it may be of interest to the reader
//   - what products are being highlighted
// Include an approved SUSE | Partner logo lock-up if possible
// Include any additional, relevant details
// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =

Organizations adopt cloud native practices, leveraging containers and Kubernetes, to gain advantages of efficiency, scale, and agility for their application workloads.
SUSE Rancher Prime is the enterprise, open source, cloud native management platform of choice, enabling organizations to unify and streamline management of their Kubernetes estates wherever they are - in their data centers, in the clouds, and even at the edge.

However, modernizing monolithic, legacy applications can be difficult.
This means that enterprises often need to separately maintain and manage traditional IT infrastructure, such as virtual machines (VMs), for these applications while continuing their cloud native journeys.
The results in higher infrastructure and operational costs, and can slow or derail modernization progress.

SUSE and Veeam help enterprises unify their IT landscapes.
With SUSE Virtualization enterprises get “day 1” and “day 2” management of VMs alongside containers in their cloud native estates.
For business continuity, Veeam Kasten for Kubernetes provides backup, disaster recovery, mobility, and ransomware protection for both containers and VMs.
Together, SUSE and Veeam enable enterprises to reap the benefits of reduced infrastructure and operational overhead while they continue their modernization journeys.


=== Scope

// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =
// Specify what this guide covers in no more than 2 sentences.
//   E.g., "You will learn how to ..."
// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =

For implementation of Veeam Kasten with SUSE Virtualization, this guide provides:

* an architectural overview
* step-by-step deployment and configuration instructions
* review of known limitations


=== Audience

// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =
// Identify for whom this document is intended, perhaps with:
//   - topics of interests (e.g., machine learning, security, etc.)
//   - job roles (e.g., developer, administrator, platform architect, etc.)
//   - required skills
// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =

The intended audience for this document includes solution and infrastructure architects, system administrators, platform engineers, virtualization administrators, and backup and recovery administrators.
A basic understanding of virtualization, Linux, and Kubernetes concepts and technologies is required to successfully follow and apply this guide.



== Architecture

image::veeam_kasten_arch.png[Rancher by SUSE and Kasten by Veeam, scaledwidth="100%", align="center"]

Veeam Kasten is deployed to the SUSE Virtualization cluster, using the underlying RKE2 Kubernetes cluster for the control plane, and includes NGNIX ingress to serve the Kasten UI.
Once installed in the cluster, Kasten can view all namespaces and resources and administrators can create backup policies for namespaces or individual VMs.


=== Components

Component technologies used in this guide include:

* {comp2-website}[{comp2}] ({comp2-version1} or later}) providing data protection

* {comp4-website}[{comp4}] ({comp4-version1} or later) providing management of downstream clusters

* Two or more physical Linux servers as worker nodes to host VMs
//
+
For this guide, {comp3-website}[{comp3}] {comp3-version1} is used as the worker node operating system.

* Downstream {comp5-website}[{comp5}] ({comp5-version1} or later) cluster on the worker nodes

* {comp1-website}[{comp1}] ({comp1-version1} or later) installed onto the RKE2 cluster and configured on each node


[NOTE]
====
Always check the current https://www.suse.com/suse-rancher/support-matrix/[product support matrices] to ensure proper choice of product versions.
====


=== Additional resources

* A workstation you will use to connect to and administer the cluster environment
* https://helm.sh[Helm] 3 Kubernetes package manager installed on your workstation
* https://kubernetes.io/docs/reference/kubectl/[Kubectl] command line tool installed on your workstation for accessing the Kubernetes API

== Procedure
// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =
// Detail the steps of the installation procedure.
// Replace 'Procedure' with one or more appropriate sections, such as:
// - 'Setting up the environment'
// - 'Installing the components'
// - 'Configuring and tuning'
// - 'Validating the deployment'
// You may find it useful to organize complex procedures into
// subsections.
//
// - As appropriate, make use of:
//   - Ordered lists for steps
//   - Code blocks for source code and console commands
//     Readers should be able to use copy and paste to leverage
//     commands and code in their environments
//   - Listing blocks for output
//   - Screenshots and diagrams
//   - Admonitions (notes, tips, warnings, etc.)
//
// NOTE: Always include some validation or verification in your guide.
//
// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =

1. After deploying a SUSE Virtualization cluster, navigate to the cluster and log in.

2. Click Support at the bottom of the menu.
+
image::veeam_kasten_2_.png[Rancher by SUSE and Kasten by Veeam, scaledwidth="50%", align="left"]

3. Click Download KubeConfig.
+
image::veeam_kasten_3_.png[Rancher by SUSE and Kasten by Veeam, scaledwidth="50%", align="left"]

4. Save the file in your local Kubernetes configuration folder (typically ~/.kube on Linux and MacOSX).

5. Confirm connectivity to the SUSE Virtualization RKE2 cluster. 

+
[source, bash]
----
kubectl get nodes
----

6. Annotate the `harvester-longhorn` storage class so that Kasten can export block-mode disks.

+
[source, bash]
----
kubectl annotate storageclass harvester-longhorn \
k10.kasten.io/sc-supports-block-mode-exports=true
----

7. Annotate the longhorn-snapshot ‘volumesnapshotclass’ so Kasten can use it to take storage snapshots.

+
[source, bash]
----
kubectl annotate volumesnapshotclass longhorn-snapshot \
k10.kasten.io/is-snapshot-class=true
----

8. Add the Kasten repository to Helm.

+
[source, bash]
----
helm repo add kasten https://charts.kasten.io
----

9. Install Kasten via Helm.

+
[source, bash]
----
helm install k10 kasten/k10 \
--namespace 'kasten-io' \
--create-namespace \
--set "ingress.create=true" \
--set-string "ingress.class=nginx" \
--set "auth.basicAuth.enabled=true" \
--set-string "auth.basicAuth.htpasswd=kasten:{SHA}3ddV7KLvFY/54nJZFXKfZHzF78k="
----

+
[NOTE]
====
This will install Kasten with basic authentication, with a username of ‘kasten’ and password ‘Kasten/4u!’.   If you wish to use a different username and password, you can do so by generating a different htpasswd string and replacing the string in the command above.
====

10. Watch the Kasten pods and wait for all to have a status of RUNNING.

+
[source, bash]
----
watch ‘kubectl get pods -n kasten-io’
----

11. Using your web browser, enter the hostname or IP of the SUSE Virtualization VIP, and append ‘/k10/’ to the end of the URL. The Kasten dashboard should load and ask for a username and password.  Enter ‘kasten’ and ‘Kasten/4u!’ if you did not change the htpasswd string in the Helm installation command, otherwise enter the username and password you configured.

+
image::veeam_kasten_11_.png[Rancher by SUSE and Kasten by Veeam, scaledwidth="85%", align="left"]

12. Kasten can now be configured to send backups to an external source.  To do so, navigate to Profiles > Location Profiles, choosing Add New and selecting the relevant storage provider and configuring authentication. Note that multiple location profiles can be defined, allowing administrators to send backup data to different locations depending on requirements, cost, etc.

+
image::veeam_kasten_12_.png[Rancher by SUSE and Kasten by Veeam, scaledwidth="85%", align="left"]

13. Backup policies can now be configured to protect workloads.  To do so, navigate to Applications, click the menu to the right of a namespace you wish to protect, and select Create Policy.

+
image::veeam_kasten_13_.png[Rancher by SUSE and Kasten by Veeam, scaledwidth="85%", align="left"]

14. The backup policy can now be defined, including scheduling and frequency, the retention schedule, where to export backup data.

+
image::veeam_kasten_14_.png[Rancher by SUSE and Kasten by Veeam, scaledwidth="85%", align="left"]



== Summary

// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =
// Summarize:
// - Solution description
// - Motivation for the guide
// - What was done
// - Suggested next steps for the learning journey
// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =

Veeam Kasten can provide backup, restore, DR, and ransomware protection for SUSE Virtualization and SUSE Rancher workloads.  It’s simple to deploy and can be protecting workloads in a matter of minutes.

In this guide, we identified prerequisites, how to deploy Veeam Kasten to a SUSE Virtualization environment, and how to begin protecting workloads.  For more information or detail around advanced capabilities, refer to the Veeam Kasten Documentation at docs.kasten.io. 






// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =
// Do not modify below this break.
// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =

++++
<?pdfpagebreak?>
++++


:leveloffset: 0

== Legal notice
include::common_trd_legal_notice.adoc[]

++++
<?pdfpagebreak?>
++++


:leveloffset: 0
include::common_gfdl1.2_i.adoc[]

//end
